<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Article">
  	<head>
  		<!-- Volta CSS Stuff -->
    	<link rel="icon" type="image/ico" href="https://d2gl3otkt8l7qr.cloudfront.net/favicon.png">
 		<link rel="stylesheet" href="https://d2gl3otkt8l7qr.cloudfront.net/assets/1.2/dist/css/volta.css">
		<!-- Okta widget stuff -->
		<script src="https://ok1static.oktacdn.com/assets/js/sdk/okta-signin-widget/2.16.0/js/okta-sign-in.min.js" type="text/javascript"></script>
		<link href="https://ok1static.oktacdn.com/assets/js/sdk/okta-signin-widget/2.16.0/css/okta-sign-in.min.css" type="text/css" rel="stylesheet"/>
		<link href="https://ok1static.oktacdn.com/assets/js/sdk/okta-signin-widget/2.16.0/css/okta-theme.css" type="text/css" rel="stylesheet"/>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<!-- <script src="index.js"></script>	 -->

  	</head>
	<body>
	  <div class="Vlt-margin--top3 Vlt-margin--M-top2 Vlt-margin--S-top1">
	  	<div class="Vlt-col">
		  	<header class="Vlt-header">
		  		<div class="Vlt-grid">
		  			<div class="Vlt-col">
		  				<div class="Vlt-grid">
				  			<div class="Vlt-col Vlt-col--1of2">
		          		<div class="Vlt-header__logo">
		              	<a href="/user" >
		                	<img src="https://www.vonage.com/assets/images/logo-vonage.svg#volta">
		              	</a>
		            	</div>
				  			</div>
			  			</div>
			  		</div>
			  		<div class="Vlt-col Vlt-col--1of4">
				  		<div class="Vlt-header__menu">
								<div class="top-navigation Vlt-tabs__header">
									<a class="Vlt-tabs__link" href="/user" id="area--about">Link 1</a>
									<a class="Vlt-tabs__link Vlt-tabs__link_active" href="/calls" id="area--styles">Link 2</a>
									<a class="Vlt-tabs__link" href="/index" id="status">Link 3</a>
								</div>  			
				  		</div>
				  	</div>
				  	<div class="Vlt-col Vlt-col--4of4 Vlt-right">
				  	  <p id="email_addr"> </p>
				      <form id="auth_form" action="implicit/auth">    
				        <div class="Vlt-form__element Vlt-form__element--big">            
				          <button id="auth_button" class="Vlt-btn Vlt-btn--primary" type="Submit">Sign-In</button>
				        </div>
				      </form>				  		
				  	</div>		  	
			  	</div>
			</header>
	  	</div>
	  	<p></p>
	  	<p></p>
		<div class="Vlt-grid">
			<div class="Vlt-col">
			</div>
			<div class="Vlt-col">
			</div>
			<div class="Vlt-col">
			</div>
			<div class="Vlt-col">
			</div>
			<div class="Vlt-grid__separator"><!-- Empty line breaker --></div>
			<div class="Vlt-col">				
			</div>
			<div class="Vlt-col Vlt-col--3of4">

				<!-- Use Case 1 -->
				<div class="Vlt-card">
					<div class="Vlt-card__header">
						<h3>Sequential Dialer - Cust. Engagement</h3>
					</div>
					<div class="Vlt-card__content">
						<div class="Vlt-grid">
							<div class="Vlt-col">
								<p><b>Use Case</b></p>
								<p>Make outbound calls to a list of numbers, and connect to the first number that is picked up without going to voicemail</p>	
								<ul class="Vlt-list Vlt-list--simple">
									<li>Create a local presence</li>
									<li>Number pool management</li>
									<li>Reduce costs</li>
									<li>Automated dialing</li>
									<li>Machine/voicemail detection</li>
								</ul>
							</div>
							<div class="Vlt-col">
								<p><b>Benefits</b></p>
								<ul class="Vlt-list Vlt-list--simple">
									<li>Automated experience for agents</li>
									<li>Limits human error</li>
									<li>Connect agents to customers faster</li>
									<li>Ensure accuracy of availability</li>
								</ul>
							
							</div>
						</div>	
					</div>													
					<div class="Vlt-card__footer">
				      <form action="https://a699a865.ngrok.io/test" method="post"> 
				      	<input id="app_link_email" type="hidden" name="email_addr" value="">   
				        <div class="Vlt-form__element Vlt-form__element--big">            
				          <button id="app_link" class="Vlt-btn Vlt-btn--primary Vlt-btn--app" type="Submit">Start Demo</button>
				        </div>
				      </form>
					</div>					
				</div>	

				<!-- Use Case 2 -->
				<div class="Vlt-card">
					<div class="Vlt-card__header">
						<h3>Appointment Reminders - Productivity</h3>
					</div>
					<div class="Vlt-card__content">
						<div class="Vlt-grid">
							<div class="Vlt-col">
								<p><b>Use Case</b></p>
								<p>Alert customers for appointment reminders with a phone call and allow them to confirm with a key press</p>	
								<ul class="Vlt-list Vlt-list--simple">
									<li>Create a local presence</li>
									<li>Number pool management</li>
									<li>Eliminate erroneous notifications</li>
									<li>Text to speech</li>
									<li>Real time interaction</li>
								</ul>
							</div>
							<div class="Vlt-col">
								<p><b>Benefits</b></p>
								<ul class="Vlt-list Vlt-list--simple">
									<li>Engage your customers</li>
									<li>Enable interaction</li>
									<li>Reduce costs</li>
									<li>Improve the customer experience</li>
								</ul>
							
							</div>
						</div>	
					</div>													
					<div class="Vlt-card__footer">
						<button id="app_link" class="Vlt-btn Vlt-btn--primary Vlt-btn--app">Start Demo</button>
					</div>	
				</div>

				<!-- Use Case 3 -->
				<div class="Vlt-card">
					<div class="Vlt-card__header">
						<h3>Auto Conference Bridge- Collaboration</h3>
					</div>
					<div class="Vlt-card__content">
						<div class="Vlt-grid">
							<div class="Vlt-col">
								<p><b>Use Case</b></p>
								<p>Call multiple extensions or numbers concurrently, and any whoever picks up will join a conference call</p>	
								<ul class="Vlt-list Vlt-list--simple">
									<li>Number management</li>
									<li>Automate dialing with Voice API</li>
									<li>Machine detection</li>
									<li>Pay only for what you use</li>
									<li>Connect to VBC extension</li>
								</ul>
							</div>
							<div class="Vlt-col">
								<p><b>Benefits</b></p>
								<ul class="Vlt-list Vlt-list--simple">
									<li>Automatic conference capabilities instead of manual dialing</li>
									<li>Reduce cost and time</li>
									<li>Less human error</li>
								</ul>
							</div>
						</div>	
					</div>													
					<div class="Vlt-card__footer">
						<button id="app_link" class="Vlt-btn Vlt-btn--primary Vlt-btn--app">Start Demo</button>
					</div>	
				</div>											
			</div>
			<div class="Vlt-col">				
			</div>				
		</div>
		<script type="text/javascript" src="https://s3-us-west-2.amazonaws.com/assets-petesweb.io/assets/1.2/js/svgxuse.min.js"></script>
		<script type="text/javascript" src="https://s3-us-west-2.amazonaws.com/assets-petesweb.io/assets/1.2/dist/js/volta.min.js"/> 
		<script type="text/javascript">
			Volta.init();
		</script>    

		<!-- use the Okta widget to power authentication! -->
		<script type="text/javascript">

		  function login_setup(email){
			document.getElementById('email_addr').innerHTML = email;
        	document.getElementById('auth_form').action = "/";
        	console.log("I found tokens in URL | Setting auth_button to Sign-out");
		    document.getElementById("auth_button").innerHTML = "Sign-Out";
		    document.getElementById("app_link_email").value = email;

		  }

		  function logout_setup(okta_obj){
        	console.log("Just clicked auth_button - Logging out and trying to set auth_button to Sign-in");
	        okta_obj.session.close(function (err) {
	          console.log("Just cleared tokenManager, still trying to set auth_button to Sign-in"); 	          	
	          if (err) {
   		        console.log("Error logging out: " + err);
                // The user has not been logged out, perform some error handling here.
                return;
              } else {
      	        console.log("Confirmed User has been logged out and changing auth_button to Sign-In");
  	      		document.getElementById("auth_button").innerHTML = "Sign-In";

              }
              // The user is now logged out. Render the Sign-In Widget.
            });
            okta_obj.tokenManager.clear();
            console.log("After clearing tokens My accessToken: " + okta_obj.tokenManager.get('accessToken'));		  	
		  }  

		  var oktaSignIn = new OktaSignIn({
		    baseUrl: "https://dev-729731.okta.com",
		    clientId: "0oawl0b18azKfOpTG356",
		    redirectUri: "https://fabianp5060.github.io",
		    authParams: {
		      issuer: "https://dev-729731.okta.com/oauth2/default",
		      responseType: ['token', 'id_token'],
		      display: 'page'
		    }
		  });

		  if (oktaSignIn.token.hasTokensInUrl()) {
		    oktaSignIn.token.parseTokensFromUrl(
		      // If we get here, the user just logged in.
		      function success(res) {
		        var accessToken = res[0];
		        var idToken = res[1]

		        oktaSignIn.tokenManager.add('accessToken', accessToken);
		        oktaSignIn.tokenManager.add('idToken', idToken);

		        window.location.hash='';

		        // Setup pageview for logged in user
			 	login_setup(idToken.claims.email);
		        auth_button.onclick = function (){
	        	  logout_setup(oktaSignIn);
	            } 

		      },
		      function error(err) {
		        console.error(err);
		      }
		    );
		  } else {
		    oktaSignIn.session.get(function (res) {
		      // If we get here, the user is already signed in.
		      if (res.status === 'ACTIVE') {

			    login_setup(oktaSignIn.tokenManager.get('idToken').claims.email)
		        auth_button.onclick = function (){
	        	  logout_setup(oktaSignIn);	          
	            }    	        	
		        return;
		      } else {
		      	  // This means that the user is not logged in
		      	  document.getElementById("status").innerHTML = "I am not logged in";		      	  
		  		  console.log("Didi not find accesstoke");
		    		
     			  window.onload = function(){
		  	  		document.getElementById('auth_form').action = "implicit/auth";
		  	  		document.getElementById("auth_button").innerHTML = "Sign-In";
 		  		  }		      	  
		      }	      
		    });
		  }
		  // Add okta toke to Auth Header and redirect to demo
		  document.getElementById("app_link").onclick = function(){
		    var accessToken = oktaSignIn.tokenManager.get('accessToken');
		    console.log("At least i Made it to here: app_link.onclick")

		    if (!accessToken) {
		      // This means that the user is not logged in
		      return;
		    }

		    // Make a request using jQuery
		    $.ajax({
		      // Your API or resource server:
		      url: 'https://demo2-lb.petesweb.io/answer_home',
		      headers: {
		        Authorization: 'Bearer ' + accessToken.accessToken
		      },
		      success: function(response) {
		        // Received messages!
		        console.log('Messages', response);
		      },
		      error: function(response) {
		        console.error(response);
		      }
		    });
		  }

		</script>
  	</body>
</html>
